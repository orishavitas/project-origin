{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "request.json",
  "title": "ParsedRequest",
  "description": "Structured data extracted from product research request email. Human Reference: PRD.md ยง4.1",
  "type": "object",
  "required": [
    "request_id",
    "sender",
    "product_concept",
    "raw_email",
    "extracted_data",
    "gaps",
    "scope_flags",
    "metadata"
  ],
  "properties": {
    "request_id": {
      "type": "string",
      "description": "Unique identifier (format: ORIGIN-YYYYMMDD-XXXX)"
    },
    "sender": {
      "type": "object",
      "required": ["email", "name", "department"],
      "properties": {
        "email": {
          "type": "string",
          "format": "email"
        },
        "name": {
          "type": "string"
        },
        "department": {
          "type": "string",
          "enum": ["Sales", "Marketing", "R&D", "Unknown"]
        },
        "inferred_from": {
          "type": "string",
          "description": "How department was determined (signature, domain, etc.)"
        }
      }
    },
    "product_concept": {
      "type": "object",
      "required": ["name", "summary"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Product name (from subject or inferred)"
        },
        "summary": {
          "type": "string",
          "description": "1-2 sentence product concept summary"
        }
      }
    },
    "raw_email": {
      "type": "object",
      "required": ["subject", "body", "received_at"],
      "properties": {
        "subject": {
          "type": "string"
        },
        "body": {
          "type": "string"
        },
        "thread_id": {
          "type": "string"
        },
        "message_id": {
          "type": "string"
        },
        "received_at": {
          "type": "string",
          "format": "date-time"
        },
        "attachments": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "filename": { "type": "string" },
              "mime_type": { "type": "string" },
              "size_bytes": { "type": "integer" }
            }
          }
        }
      }
    },
    "extracted_data": {
      "type": "object",
      "description": "Data extracted from email mapped to MRD sections",
      "properties": {
        "target_markets": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["Retail", "Hospitality", "Healthcare", "Corporate", "Education", "Other"]
          }
        },
        "use_cases": {
          "type": "array",
          "items": { "type": "string" }
        },
        "target_price": {
          "type": "object",
          "properties": {
            "value": { "type": "number" },
            "currency": { "type": "string", "default": "USD" },
            "type": { 
              "type": "string", 
              "enum": ["exact", "range", "maximum", "approximate"] 
            }
          }
        },
        "technical_requirements": {
          "type": "object",
          "properties": {
            "device_compatibility": {
              "type": "array",
              "items": { "type": "string" }
            },
            "vesa_pattern": {
              "type": "string",
              "enum": ["75x75", "100x100", "200x200", "custom", "none", null]
            },
            "materials": {
              "type": "array",
              "items": { "type": "string" }
            },
            "other": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "volume_expectation": {
          "type": "object",
          "properties": {
            "quantity": { "type": "integer" },
            "period": { "type": "string" },
            "type": { 
              "type": "string", 
              "enum": ["exact", "minimum", "range", "approximate"] 
            }
          }
        },
        "timeline": {
          "type": "object",
          "properties": {
            "urgency": {
              "type": "string",
              "enum": ["high", "medium", "low", "not_specified"]
            },
            "target_date": {
              "type": "string",
              "format": "date"
            },
            "notes": { "type": "string" }
          }
        },
        "additional_context": {
          "type": "string",
          "description": "Any other relevant information from the email"
        }
      }
    },
    "gaps": {
      "type": "object",
      "description": "Missing information required for MRD",
      "required": ["critical", "optional"],
      "properties": {
        "critical": {
          "type": "array",
          "description": "Must be filled before MRD generation",
          "items": {
            "type": "object",
            "required": ["field", "reason"],
            "properties": {
              "field": { "type": "string" },
              "reason": { "type": "string" }
            }
          }
        },
        "optional": {
          "type": "array",
          "description": "Would improve MRD but not required",
          "items": {
            "type": "object",
            "required": ["field", "reason"],
            "properties": {
              "field": { "type": "string" },
              "reason": { "type": "string" }
            }
          }
        }
      }
    },
    "scope_flags": {
      "type": "array",
      "description": "Scope concerns identified during parsing",
      "items": {
        "type": "object",
        "required": ["level", "reason"],
        "properties": {
          "level": {
            "type": "string",
            "enum": ["green", "yellow", "red"]
          },
          "reason": { "type": "string" },
          "recommendation": { "type": "string" }
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["parsed_at", "parser_version"],
      "properties": {
        "parsed_at": {
          "type": "string",
          "format": "date-time"
        },
        "parser_version": {
          "type": "string",
          "description": "Prompt version used for parsing"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Overall parsing confidence score"
        }
      }
    }
  }
}
